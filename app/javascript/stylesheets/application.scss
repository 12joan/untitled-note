@import "./react-tags";
@import "./actiontext";

$enable-negative-margins: true;
$enable-cssgrid: true;
$transition-collapse: none;
$offcanvas-transition-duration: 0.3s;
$carousel-transition-duration: 0.3s;

@import "bootstrap/scss/bootstrap";

:root {
  --sheet-padding: 1.5rem;
  --sheet-border-radius: 1rem;
}

@include media-breakpoint-up(md) {
  :root {
    --sheet-padding: 3rem;
    --sheet-border-radius: 2rem;
  }
}

html, body {
  height: 100%;
  word-break: break-word;
  overflow-wrap: break-word;
  overflow-wrap: anywhere;
}

// Bootstrap Icons
.bi {
  vertical-align: -.125em;
}

.btn-light {
  @extend .bg-white;
  @extend .border;

  &:hover, &:focus {
    @extend .bg-light;
  }
}

.btn-link {
  @extend .p-0;
  @extend .align-baseline;
}

.btn-icon {
  @extend .px-2;
  @extend .py-1;

  &.btn-icon-inline {
    @extend .my-n1;
  }

  &:hover, &:focus {
    @extend .bg-light;
  }
}

.rounded-lg {
  border-radius: var(--sheet-border-radius);
}

.rounded-1rem {
  border-radius: 1rem;
}

.p-lg {
  padding: var(--sheet-padding);
}

.placeholder {
  background-color: $gray-300;
}

.focused {
  box-shadow: $input-focus-box-shadow;
  outline: none;
}

.focusable:focus {
  &:focus {
    @extend .focused;
  }
}

kbd {
  @extend .border;
  @extend .bg-light;
  @extend .text-dark;

  display: inline-block;
  text-align: center;
  min-width: 2em;
}

.dropdown-item {
  &.dropdown-item-danger {
    &:active {
      @extend .bg-danger;
      @extend .text-white;
    }

    &:not(:active) {
      @extend .text-danger;
    }
  }
}

@mixin btn-selectable($selected-selector) {
  &:not(#{$selected-selector}) {
    @extend .btn-light;
  }

  &#{$selected-selector} {
    @extend .btn-primary;
  }
}

.btn-project {
  @extend .text-start;
  @include btn-selectable('.selected');
}

.dim-on-hover {
  &:not(:focus):not(:focus-within):hover {
    @extend .bg-light;
  }
}

#sidebar {
  &:not(.offcanvas) {
    width: $offcanvas-horizontal-width;
  }
}

.navigation-menu {
  .navigation-menu-item {
    @extend .d-block;
    @extend .mx-n3;
    @extend .px-3;
    @extend .py-1;
    @extend .text-decoration-none;
    @extend .focusable;

    &.active {
      @extend .bg-primary;
      @extend .text-white;
    }

    &:not(.active) {
      @extend .text-dark;

      &:hover, &:focus {
        @extend .bg-light;
      }
    }
  }
}

.document-grid-tile {
  position: relative;

  &:focus-within .document-grid-tile-card {
    @extend .focused;
  }

  &:hover, &:focus-within {
    .document-grid-tile-card {
      @extend .bg-light;
    }
  }

  .document-grid-tile-card {
    @extend .card;
    @extend .card-body;
    @extend .ratio;
    @extend .ratio-16x9;

    overflow: hidden;
    border-radius: calc(var(--sheet-border-radius) * 0.75);

    .document-grid-tile-preview {
      position: absolute;
      left: -50%;
      width: 200%;
      height: 200%;

      transform: scale(0.5);
      transform-origin: top;
      pointer-events: none;

      padding: calc(var(--sheet-padding) * 0.75);
    }
  }

  .document-grid-tile-label a {
    outline: none;
  }
}

.document-placeholder {
  @extend .placeholder;
  @extend .d-block;

  padding: var(--sheet-padding);
  border-radius: var(--sheet-border-radius);
}

.document-editor {
  @extend .position-relative;
  @extend .bg-white;
  @extend .shadow;
  @extend .rounded-lg;
  @extend .p-lg;

  .title-input, .react-tags {
    @extend .dim-on-hover;
  }

  &.sync-failed::after {
    @extend .bg-danger;

    content: '';
    border-radius: var(--sheet-border-radius);
    opacity: 0.2;
    pointer-events: none;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1035; // Just below offcanvas-backdrop
  }

  .document-editor-footer {
    @extend .bg-white;

    margin: 0 calc(-1 * var(--sheet-padding)) calc(-1 * var(--sheet-padding)) calc(-1 * var(--sheet-padding));
    padding: 0 var(--sheet-padding) 0 var(--sheet-padding);
    border-radius: 0 0 var(--sheet-border-radius) var(--sheet-border-radius);
  }

  .title-input {
    @extend .h1;
    @extend .w-100;
    @extend .rounded-0;
    @extend .p-0;
    @extend .border-0;
    @extend .border-bottom;

    font-family: Georgia, "Times New Roman", serif;
    outline: none;
  }

  .react-tags {
    @extend .border-0;
    @extend .py-0;
    @extend .px-1;
    @extend .mx-n1;

    @extend .rounded-1rem;

    .keyword-tag {
      background-color: lighten($blue-100, 5%);

      &:hover, &:focus {
        background-color: $blue-100;
      }

      .btn-delete {
        background-color: lighten($blue-100, 5%);

        &:hover, &:focus {
          background-color: $blue-100;
        }
      }
    }

    .react-tags__search {
      @extend .mb-0;

      .react-tags__search-input {
        @extend .bg-transparent;
      }
    }

    .react-tags__suggestions {
      ul {
        @extend .dropdown-menu;
        @extend .show;

        li {
          @extend .dropdown-item;

          &.is-active {
            @extend .bg-primary;

            &, mark {
              @extend .text-white;
            }
          }

          mark {
            @extend .p-0;
            @extend .text-decoration-none;
          }
        }
      }
    }
  }

  [id^="trix-editor-top-level-"] {
    flex-grow: 1;
  }

  trix-editor {
    @extend .document-body;
  }

  .trix-toolbar {
    overflow-x: auto;
    white-space: nowrap;
    height: 2rem;

    .btn-toolbar {
      @include btn-selectable('.trix-active');

      @extend .fs-5;
      @extend .px-2;
      @extend .py-1;

      &:not(.trix-active) {
        @extend .text-secondary;
      }
    }
  }
}

.document-body {
  @extend .h-100;
  @extend .m-0;
  @extend .p-0;
  @extend .rounded-0;

  font-family: Georgia, "Times New Roman", serif;
  font-size: 1.125em;
  border: none;
  outline: none;
  min-height: 80px;

  & > :last-child {
    margin-bottom: 0 !important;
  }

  h1:not(.title) {
    @extend .h3;
  }

  blockquote {
    @extend .p-3;

    border-left: 0.35em solid $secondary;
  }

  pre {
    @extend .card;
    @extend .card-body;
    @extend .bg-transparent;

    br {
      margin-top: 1em;
    }
  }

  a {
    cursor: pointer;
  }
}

#trix-dialogs {
  .trix-validate {
    @extend .is-invalid;
  }
}
